# 機能仕様書: 商品管理機能

**ブランチ名**: `004-product-management`
**作成日**: 2026-02-09
**ステータス**: Draft
**入力**: 管理者向け商品CRUD・ステータス管理機能

## ユーザーシナリオとテスト

### ユーザーストーリー 1 — 商品一覧表示と管理操作（優先度: P1）

管理者としてログインし、登録されている全商品をテーブル形式で一覧表示できる。各商品について商品名・価格・ステータスを確認でき、編集・削除・ステータス変更の操作を行える。商品数が多い場合はページネーションで分割表示される。

**優先度の理由**: 商品管理の基盤となるページであり、他の全操作（新規登録・編集・削除・ステータス変更）の起点となるため、最優先で実装する必要がある。

**独立テスト**: 管理者でログイン後、商品管理ページにアクセスし、テーブル形式で商品一覧が表示されること、ステータスドロップダウンからの変更が即時反映されることを確認すれば単独でテスト可能。

**受入シナリオ**:

1. **前提**: 管理者としてログイン済みで商品が3件登録されている。**操作**: 商品管理ページにアクセスする。**結果**: 3件の商品がテーブル形式で表示され、各商品の商品名・価格・ステータスが確認できる。
2. **前提**: 管理者としてログイン済みで商品が25件登録されている。**操作**: 商品管理ページにアクセスする。**結果**: 1ページ目に20件が表示され、ページネーションで2ページ目に遷移すると残り5件が表示される。
3. **前提**: 管理者としてログイン済みで「下書き」ステータスの商品がある。**操作**: 一覧のドロップダウンでステータスを「公開中」に変更する。**結果**: ステータスが即時に「公開中」に更新され、一覧に反映される。
4. **前提**: 購入者としてログイン済み。**操作**: 商品管理ページにアクセスしようとする。**結果**: アクセスが拒否される。

---

### ユーザーストーリー 2 — 商品新規登録（優先度: P2）

管理者が新しい商品を登録できる。登録フォームで商品名（必須）・価格（必須）・説明（任意）・画像URL（任意）・在庫数（任意）を入力し、登録ボタンを押すと「下書き」ステータスで商品が作成される。登録完了後は商品一覧に遷移する。

**優先度の理由**: 商品データを新たに追加する機能であり、商品管理の中核機能。一覧表示の次に実装すべき。

**独立テスト**: 管理者でログイン後、新規登録ページで必須項目を入力して登録し、一覧に新商品が「下書き」ステータスで表示されることを確認すれば単独でテスト可能。

**受入シナリオ**:

1. **前提**: 管理者としてログイン済み。**操作**: 商品名「テスト商品A」、価格「1500」を入力して登録する。**結果**: 商品が「下書き」ステータスで作成され、商品一覧に遷移し、「テスト商品A」が一覧に表示される。
2. **前提**: 管理者としてログイン済み。**操作**: 商品名を空欄のまま登録しようとする。**結果**: バリデーションエラーが表示され、商品は登録されない。
3. **前提**: 管理者としてログイン済み。**操作**: 商品名・価格に加え、説明「詳細な説明文」、画像URL、在庫数「100」を入力して登録する。**結果**: 全項目が保存され、商品が「下書き」ステータスで作成される。
4. **前提**: 管理者としてログイン済み。**操作**: 価格に「-100」（負の値）を入力して登録しようとする。**結果**: バリデーションエラーが表示され、商品は登録されない。

---

### ユーザーストーリー 3 — 商品編集（優先度: P3）

管理者が既存商品の情報を編集できる。編集ページを開くと既存データがフォームにプリロードされ、変更したいフィールドのみを更新できる。保存後は商品一覧に遷移する。

**優先度の理由**: 登録済み商品の修正は日常的な運用で必要になる。新規登録の次に実装する。

**独立テスト**: 管理者でログイン後、既存商品の編集ページを開き、商品名を変更して保存し、一覧で変更が反映されていることを確認すれば単独でテスト可能。

**受入シナリオ**:

1. **前提**: 管理者としてログイン済みで商品「テスト商品A」（価格1500円）が登録されている。**操作**: 編集ページを開くと既存データがフォームに表示される。商品名を「テスト商品B」に変更して保存する。**結果**: 商品名が「テスト商品B」に更新され、価格は1500円のまま変わらない。商品一覧に遷移する。
2. **前提**: 管理者としてログイン済み。**操作**: 存在しない商品IDの編集ページにアクセスする。**結果**: 404エラーが表示される。
3. **前提**: 管理者としてログイン済み。**操作**: 商品名を空欄に変更して保存しようとする。**結果**: バリデーションエラーが表示され、変更は保存されない。

---

### ユーザーストーリー 4 — 商品削除（優先度: P4）

管理者が不要な商品を削除できる。誤削除を防ぐため、削除前に確認ダイアログを表示する。

**優先度の理由**: 削除は不可逆操作であり他機能に依存しないが、一覧・登録・編集より優先度は低い。

**独立テスト**: 管理者でログイン後、商品一覧から商品の削除ボタンを押し、確認ダイアログで「削除する」を選択した後、その商品が一覧から消えていることを確認すれば単独でテスト可能。

**受入シナリオ**:

1. **前提**: 管理者としてログイン済みで商品が3件登録されている。**操作**: 1件の商品の削除ボタンを押す。**結果**: 確認ダイアログが表示される。
2. **前提**: 確認ダイアログが表示されている。**操作**: 「削除する」を選択する。**結果**: 商品が削除され、一覧には残り2件が表示される。
3. **前提**: 確認ダイアログが表示されている。**操作**: 「キャンセル」を選択する。**結果**: 商品は削除されず、一覧には3件のまま表示される。

---

### エッジケース

- 商品名に200文字を超える文字列を入力した場合、バリデーションエラーが表示される
- 説明に2000文字を超える文字列を入力した場合、バリデーションエラーが表示される
- 画像URLに無効な形式の文字列を入力した場合、バリデーションエラーが表示される
- 在庫数に小数値や負の値を入力した場合、バリデーションエラーが表示される
- 商品が0件の場合、一覧ページに「商品がありません」のメッセージが表示される
- 編集中に他の管理者が同じ商品を削除した場合、保存時にエラーメッセージが表示される
- 削除対象の商品が既に注文に含まれている場合でも削除は実行される（商品管理と注文は独立ドメイン）

## 要件

### 機能要件

- **FR-001**: 管理者は商品管理ページで全商品をテーブル形式で一覧表示できること（商品名・価格・ステータス列）
- **FR-002**: 商品一覧は20件/ページでページネーション表示すること
- **FR-003**: 管理者は商品名（必須・1〜200文字）と価格（必須・0以上の整数）を入力して商品を新規登録できること
- **FR-004**: 新規登録時に説明（任意・最大2000文字）、画像URL（任意・有効なURL形式）、在庫数（任意・0以上の整数、デフォルト0）を入力できること
- **FR-005**: 新規登録された商品は「下書き」（draft）ステータスで作成されること
- **FR-006**: 登録完了後は商品一覧ページに遷移すること
- **FR-007**: 管理者は既存商品の編集ページを開くと、既存データがフォームにプリロードされること
- **FR-008**: 商品編集は部分更新（変更したフィールドのみ更新）をサポートすること
- **FR-009**: 存在しない商品IDの編集ページにアクセスした場合は404エラーを表示すること
- **FR-010**: 管理者は商品を削除でき、削除前に確認ダイアログを表示すること
- **FR-011**: 管理者は商品一覧のドロップダウンからステータスを即時変更できること
- **FR-012**: ステータスは「下書き」（draft）・「公開中」（published）・「アーカイブ」（archived）の3種類であること
- **FR-013**: 全ステータス間の遷移が可能であること（遷移制限なし）
- **FR-014**: 全操作は管理者（admin）ロールでのログインを必須とし、購入者（buyer）ロールのアクセスは拒否すること
- **FR-015**: 入力値のバリデーションエラーは、該当フィールドの近くにエラーメッセージを表示すること

### 主要エンティティ

- **商品（Product）**: 管理者が管理する商品データ。商品ID、商品名、価格、説明、画像URL、在庫数、ステータス（draft/published/archived）、作成日時、更新日時を持つ。
- **ステータス**: 商品の公開状態を表す。「下書き」（draft）、「公開中」（published）、「アーカイブ」（archived）の3種類。全ステータス間の遷移が可能。

## 成功基準

### 計測可能な成果

- **SC-001**: 管理者が商品の新規登録を2分以内に完了できる（必須項目のみの場合）
- **SC-002**: 管理者が商品のステータス変更を5秒以内に完了できる（ドロップダウン選択のみ）
- **SC-003**: 管理者が商品の編集を1分以内に完了できる（1フィールドの変更の場合）
- **SC-004**: 全操作において購入者ロールのアクセスが100%拒否される
- **SC-005**: バリデーションエラーが発生した場合、ユーザーは即座にどのフィールドに問題があるかを特定できる

## スコープ外

- 画像ファイルのアップロード機能（URL直接入力方式のみ）
- 在庫引き当て（注文時の在庫減算）
- 商品の一括操作（一括削除・一括ステータス変更）
- 商品の検索・フィルタリング機能
- 商品の並び替え機能
- 購入者向けカタログへの商品反映ロジック（catalog ドメインは独立しており、本機能のスコープ外）

## 前提条件

- セッション認証が実装済みで、admin/buyerのロール判定が可能
- 購入者向けカタログ閲覧機能（catalog ドメイン）は別途実装済み
- 商品管理は catalog ドメインとは異なるバウンデッドコンテキストのため、独立した product ドメインとして実装する
- 確認ダイアログコンポーネント（ConfirmDialog）は既存テンプレートを再利用可能
- 管理者レイアウトのナビゲーションに「商品管理」リンクを追加する
