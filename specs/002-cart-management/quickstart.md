# クイックスタート: カート管理機能

## 前提条件

- カタログ閲覧機能（001-catalog-listing）が実装済み
- 購入者認証（ログイン・ログアウト）機能が動作可能
- Node.js + npm がインストール済み

## セットアップ

```bash
# 依存関係のインストール
npm install

# 開発サーバー起動
npm run dev
```

## 動作確認シナリオ

### シナリオ 1: カートに商品を追加する

1. `http://localhost:3000/login` にアクセスし、購入者としてログイン
2. `http://localhost:3000/catalog` で商品一覧を表示
3. 任意の商品をクリックして商品詳細ページを開く
4. 「カートに追加」ボタンをクリック
5. **期待結果**: 成功メッセージが表示され、ヘッダーのカートアイコン件数が更新される

### シナリオ 2: カート内容を確認する

1. ヘッダーの「カート」リンクをクリック
2. **期待結果**: カートページに商品一覧（画像・名前・単価・数量・小計）が表示される
3. **期待結果**: 商品合計・消費税（10%）・総合計が正しく表示される

### シナリオ 3: 数量を変更する

1. カートページで商品の数量を変更する
2. **期待結果**: 小計と合計金額が即時更新される
3. 在庫数を超える数量に変更を試みる
4. **期待結果**: 「在庫数を超えています」エラーメッセージが表示される

### シナリオ 4: 商品を削除する

1. カートページで商品の「削除」ボタンをクリック
2. **期待結果**: 確認ダイアログが表示される
3. 「削除する」をクリック
4. **期待結果**: 商品がカートから削除され、合計が更新される
5. 最後の商品を削除する
6. **期待結果**: 「カートに商品がありません」メッセージと商品一覧へのリンクが表示される

### シナリオ 5: 永続化の確認

1. カートに商品を追加した状態でブラウザをリロード
2. **期待結果**: カートの内容が保持されている

### シナリオ 6: 未ログイン時のリダイレクト

1. ログアウトした状態で `/cart` にアクセス
2. **期待結果**: `/login?redirect=/cart` にリダイレクトされる
3. ログイン後、カートページに戻る

## テスト実行

```bash
# 単体テスト
npx vitest run tests/unit/domains/cart/

# 統合テスト
npx vitest run tests/integration/domains/cart/

# E2E テスト
npx playwright test tests/e2e/cart/

# 全テスト
npx vitest run
npx playwright test
```

## API エンドポイント確認

```bash
# カート取得（要認証 Cookie）
curl http://localhost:3000/api/cart

# カートに商品追加
curl -X POST http://localhost:3000/api/cart/items \
  -H "Content-Type: application/json" \
  -d '{"productId": "<商品ID>", "quantity": 1}'

# 数量更新
curl -X PUT http://localhost:3000/api/cart/items/<商品ID> \
  -H "Content-Type: application/json" \
  -d '{"quantity": 3}'

# 商品削除
curl -X DELETE http://localhost:3000/api/cart/items/<商品ID>
```

## 消費税計算例

| 商品合計 | 消費税（10%、端数切り捨て） | 総合計 |
|---------|--------------------------|--------|
| ¥1,000  | ¥100                     | ¥1,100 |
| ¥5,000  | ¥500                     | ¥5,500 |
| ¥1,999  | ¥199                     | ¥2,198 |
| ¥333    | ¥33                      | ¥366   |
